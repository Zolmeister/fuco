<!doctype html>
<html>
  <head>
    <title>Fuco, The Game</title>
    <meta name="viewport" content="initial-scale=1.0, width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui">
    <style>
    html {
      background: rgb(158, 158, 158);
    }
    body {
      margin: 0;
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
      background: rgb(158, 158, 158);
      visibility: hidden;
    }
    #canv {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      visibility: hidden;
      -webkit-transition: all 0.25s linear;
      -moz-transition: all 0.25s linear;
      -ms-transition: all 0.25s linear;
      -o-transition: all 0.25s linear;
      transition: all 0.25s linear;
    }
    .slide-out {
      -webkit-transform: translate(-200%, 0);
      -moz-transform: translate(-200%, 0);
      -ms-transform: translate(-200%, 0);
      -o-transform: translate(-200%, 0);
      transform: translate(-200%, 0);
    }
    .home-screen, .game-over-screen {
      text-align: center;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
    .game-over-screen {
      display: none;
    }
    .logo {
      display: inline-block;
    }
    .flourish {
      display: inline-block;
    }
    .play, .play-again {
      cursor: pointer;
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
      display: inline-block;
      border: 2px solid #424242;
      border-radius: 0.2em;
      opacity: 0;
      outline: none;
      background: none;
      -webkit-transition: opacity 1.5s ease-in-out, background-color 0.25s ease-in-out;
      -moz-transition: opacity 1.5s ease-in-out, background-color 0.25s ease-in-out;
      -ms-transition: opacity 1.5s ease-in-out, background-color 0.25s ease-in-out;
      -o-transition: opacity 1.5s ease-in-out, background-color 0.25s ease-in-out;
      transition: opacity 1.5s ease-in-out, background-color 0.25s ease-in-out;
    }
    .play:hover, .play-again:hover {
      background: rgba(208,248,206,0.2)
    }
    button::-moz-focus-inner{
      border: 0;
    }

    </style>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-30570115-15', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>

    <canvas id='canv'></canvas>
    <div class='home-screen'>

      <svg
         xmlns="http://www.w3.org/2000/svg"
         width="101.78125"
         height="29.96875"
         id="svg2"
         version="1.1"
         class="logo" viewBox="-2 0 106 30">
        <defs
           id="defs4">
        </defs>
        <g
           transform="translate(-49,-457.48645)">
           <g
             transform="translate(0,308.2677)"
             style="font-size:40px;font-style:normal;font-variant:normal;font-weight:500;font-stretch:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Ubuntu;-inkscape-font-specification:Ubuntu Medium"
             id="flowRoot3805">
            <path
               d="m 49.526249,179.07259 -0.01875,-28.70433 17.52,0 0,4.28 -12.48,0 0,7.08 11.08,0 0,4.28 -11.08,0 0,12.08 -6.052464,0.0938"
               style="fill:none;stroke:#5677fc;stroke-linejoin:miter;stroke-opacity:1;font-family:Ubuntu;-inkscape-font-specification:Ubuntu Medium"
               id="path3814" />
            <path
               d="m 82.21875,178.68826 c -1.893345,0 -3.52001,-0.26667 -4.88,-0.8 -1.360008,-0.56 -2.49334,-1.33334 -3.4,-2.32 -0.880005,-0.98667 -1.533338,-2.14667 -1.96,-3.48 -0.42667,-1.33333 -0.640003,-2.8 -0.64,-4.4 l 0,-17.32 5.08,0 0,16.84 c -8e-6,1.25334 0.133325,2.33334 0.4,3.24 0.293324,0.88 0.693324,1.6 1.2,2.16 0.533323,0.56 1.146656,0.97333 1.84,1.24 0.719988,0.26667 1.519987,0.4 2.4,0.4 0.879985,0 1.679984,-0.13333 2.4,-0.4 0.719983,-0.26667 1.333316,-0.68 1.84,-1.24 0.533315,-0.56 0.933314,-1.28 1.2,-2.16 0.293314,-0.90666 0.43998,-1.98666 0.44,-3.24 l 0,-16.84 5.08,0 0,17.32 c -2.5e-5,1.6 -0.226691,3.06667 -0.68,4.4 -0.426691,1.33333 -1.093357,2.49333 -2,3.48 -0.880021,0.98666 -2.013354,1.76 -3.4,2.32 -1.386684,0.53333 -3.907901,0.78125 -5.801218,0.78125"
               style="fill:none;stroke:#5677fc;stroke-linejoin:miter;stroke-opacity:1;font-family:Ubuntu;-inkscape-font-specification:Ubuntu Medium"
               id="path3816" />
            <path
               d="m 111.98375,178.68826 c -2.08001,0 -3.94668,-0.32 -5.6,-0.96 -1.65334,-0.64 -3.05334,-1.57334 -4.2,-2.8 -1.14667,-1.25333 -2.02667,-2.77333 -2.64,-4.56 -0.613336,-1.78666 -0.920002,-3.83999 -0.92,-6.16 -2e-6,-2.31999 0.346664,-4.37332 1.04,-6.16 0.72,-1.78665 1.69333,-3.29331 2.92,-4.52 1.22666,-1.25331 2.66666,-2.19998 4.32,-2.84 1.65332,-0.63998 3.42665,-0.95998 5.32,-0.96 1.14665,2e-5 2.18665,0.0934 3.12,0.28 0.93331,0.16002 1.74665,0.34669 2.44,0.56 0.69331,0.21336 1.26664,0.44002 1.72,0.68 0.45331,0.24002 0.77331,0.41336 0.96,0.52 l -1.48,4.12 c -0.64002,-0.39998 -1.56002,-0.77331 -2.76,-1.12 -1.17335,-0.37331 -2.45335,-0.55998 -3.84,-0.56 -1.20001,2e-5 -2.32001,0.21335 -3.36,0.64 -1.04001,0.40002 -1.94668,1.01335 -2.72,1.84 -0.74668,0.82668 -1.33334,1.86668 -1.76,3.12 -0.42667,1.25335 -0.64001,2.70668 -0.64,4.36 -1e-5,1.46668 0.15999,2.81334 0.48,4.04 0.34666,1.22667 0.86666,2.29334 1.56,3.2 0.69332,0.88 1.57332,1.57333 2.64,2.08 1.06665,0.48 2.34665,0.72 3.84,0.72 1.78665,0 3.23998,-0.17333 4.36,-0.52 1.11998,-0.37333 1.98664,-0.72 2.6,-1.04 l 1.36,4.12 c -0.32002,0.21333 -0.76002,0.42666 -1.32,0.64 -0.53336,0.21333 -1.17336,0.42666 -1.92,0.64 -0.74669,0.18666 -1.58669,0.33333 -2.52,0.44 -0.93335,0.13333 -2.62708,0.2 -3.69373,0.2"
               style="fill:none;stroke:#5677fc;stroke-linejoin:miter;stroke-opacity:1;font-family:Ubuntu;-inkscape-font-specification:Ubuntu Medium"
               id="path3818" />
            <path
               d="m 128.6275,164.20826 c -1e-5,1.52001 0.18666,2.90667 0.56,4.16 0.37332,1.22667 0.90666,2.28 1.6,3.16 0.71999,0.85334 1.58666,1.52 2.6,2 1.01332,0.48 2.15999,0.72 3.44,0.72 1.25332,0 2.38665,-0.24 3.4,-0.72 1.01331,-0.48 1.86665,-1.14666 2.56,-2 0.71998,-0.88 1.26664,-1.93333 1.64,-3.16 0.37331,-1.25333 0.55998,-2.63999 0.56,-4.16 -2e-5,-1.51999 -0.18669,-2.89332 -0.56,-4.12 -0.37336,-1.25332 -0.92002,-2.30665 -1.64,-3.16 -0.69335,-0.87998 -1.54669,-1.55998 -2.56,-2.04 -1.01335,-0.47998 -2.14668,-0.71998 -3.4,-0.72 -1.28001,2e-5 -2.42668,0.24002 -3.44,0.72 -1.01334,0.48002 -1.88001,1.16002 -2.6,2.04 -0.69334,0.88002 -1.22668,1.93335 -1.6,3.16 -0.37334,1.22668 -0.56001,2.60001 -0.56,4.12 m 21.64,0 c -3e-5,2.37334 -0.36003,4.46667 -1.08,6.28 -0.69336,1.81334 -1.65336,3.33333 -2.88,4.56 -1.20002,1.2 -2.61336,2.10666 -4.24,2.72 -1.62669,0.61333 -3.81,0.92 -5.64998,0.92 -1.84001,0 -3.1367,-0.30667 -4.79002,-0.92 -1.62668,-0.61334 -3.05334,-1.52 -4.28,-2.72 -1.2,-1.22667 -2.16,-2.74666 -2.88,-4.56 -0.72,-1.81333 -1.08,-3.90666 -1.08,-6.28 0,-2.37332 0.36,-4.45332 1.08,-6.24 0.72,-1.81332 1.69333,-3.33331 2.92,-4.56 1.25333,-1.22664 2.69332,-2.14664 4.32,-2.76 1.62665,-0.61331 3.34665,-0.91998 5.16,-0.92 1.81332,2e-5 3.53331,0.30669 5.16,0.92 1.62664,0.61336 3.03998,1.53336 4.24,2.76 1.22664,1.22669 2.19997,2.74668 2.92,4.56 0.71997,1.78668 1.07997,3.86668 1.08,6.24"
               style="fill:none;stroke:#5677fc;stroke-linejoin:miter;stroke-opacity:1;font-family:Ubuntu;-inkscape-font-specification:Ubuntu Medium"
               id="path3820" />
          </g>
        </g>
      </svg>

      <br>

      <svg
         xmlns="http://www.w3.org/2000/svg"
         width="1052.3622"
         height="744.09448"
         id="svg3822"
         class="flourish" viewBox="0 0 1050 744"
         version="1.1">
        <defs
           id="defs3824">
        </defs>
        <g
           transform="translate(0,-308.2677)">
          <path
             style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-opacity:1;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none"
             d="m -8.9309459,416.75454 8.8545122,4.64732 C 18.727101,385.31027 43.795598,352.46852 73.449007,324.4951 103.10494,296.52437 137.38202,273.38758 174.58495,256.68724 c 1e-5,0 2e-5,-10e-6 4e-5,-2e-5 37.20075,-16.70514 77.30546,-26.96362 117.99257,-30.54641 10e-6,0 3e-5,0 4e-5,-10e-6 40.6874,-3.57969 82.00682,-0.4882 121.63463,9.48146 49.00493,12.29675 95.06744,34.75602 140.02173,58.71214 10e-6,10e-6 2e-5,10e-6 3e-5,2e-5 45.22565,24.12797 89.85809,50.04299 137.48609,69.81939 47.4815,19.73683 98.6214,33.15074 150.19502,30.89019 25.8922,-1.14689 51.6472,-6.52575 75.61068,-16.42068 23.7821,-9.816 45.79456,-24.2755 63.31988,-43.15821 2e-5,-2e-5 4e-5,-4e-5 6e-5,-6e-5 23.16838,-24.97135 38.25468,-57.54168 41.12198,-91.4565 2.8619,-33.91771 -6.8023,-68.9289 -27.57584,-95.83709 -10.40047,-13.4635 -23.55671,-24.7511 -38.35932,-33.08493 -14.77432,-8.32 -31.24191,-13.69314 -48.11919,-15.27395 -3e-5,-3e-6 -6e-5,-6e-6 -9e-5,-8e-6 -16.90899,-1.580799 -34.12819,0.719398 -50.07679,6.470928 -15.91698,5.73816 -30.61604,14.96643 -42.34298,27.14965 -2e-5,2e-5 -4e-5,4e-5 -6e-5,6e-5 -11.80022,12.26379 -20.45634,27.43774 -25.39762,43.69011 -4.94256,16.25202 -6.19201,33.65474 -3.22431,50.36255 2.96911,16.70756 10.132,32.59045 20.34289,46.10977 10.21053,13.51958 23.51492,24.73593 38.72868,32.1397 -15.17037,-7.49229 -28.38706,-18.77463 -38.49218,-32.31725 -10.10476,-13.54288 -17.14324,-29.40711 -19.99674,-46.03399 -2.85491,-16.62665 -1.50625,-33.90545 3.48973,-50.00021 4.99724,-16.09436 13.66464,-31.07751 25.39954,-43.12799 10e-6,-1e-5 2e-5,-2e-5 3e-5,-3e-5 11.65888,-11.97677 26.24328,-21.00548 41.98995,-26.5817 15.78089,-5.58639 32.78021,-7.753217 49.40987,-6.09853 16.60334,1.6491 32.78317,7.04086 47.27087,15.30754 14.51547,8.28463 27.38271,19.45881 37.50607,32.72537 20.24309,26.51154 29.49849,60.96612 26.51029,94.14391 -2.9837,33.19045 -17.9893,65.01749 -40.7711,89.29985 -17.22781,18.36888 -38.88255,32.38848 -62.24329,41.88603 -23.5566,9.57317 -48.86791,14.695 -74.28483,15.67845 -50.68391,1.98514 -101.02271,-11.60893 -147.95566,-31.37575 -47.08481,-19.85208 -91.37494,-45.93553 -136.59715,-70.38862 -3e-5,-10e-6 -6e-5,-3e-5 -8e-5,-4e-5 -44.93158,-24.32307 -91.33995,-47.24198 -141.21046,-60.12448 -40.36541,-10.40111 -82.4925,-13.81057 -124.05439,-10.39471 -3e-5,0 -6e-5,1e-5 -9e-5,1e-5 -41.56209,3.41276 -82.60727,13.65464 -120.81032,30.53722 -2e-5,1e-5 -5e-5,3e-5 -8e-5,4e-5 -38.20095,16.88743 -73.442237,40.36371 -104.000788,68.85624 -30.56107,28.48984 -56.474832,62.02875 -76.0332079,99.02784 z"
             id="path4362"
             transform="translate(0,308.2677)" />
          <path
             style="fill:none;stroke:#000000;stroke-width:3;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"
             d="m -8.8822732,724.88654 8.8175966,4.71698 C 18.699179,694.01803 50.424911,665.16003 87.796636,649.82376 c 37.365414,-15.35189 80.371084,-17.17682 119.046734,-4.94805 38.67998,12.21529 72.98613,38.47298 94.92742,72.78748 1e-5,10e-6 1e-5,10e-6 2e-5,2e-5 21.95097,34.30839 31.49044,76.60482 26.32045,117.17316 -2.64025,20.64649 -9.00977,40.95807 -20.01302,58.56549 -10e-6,2e-5 -2e-5,3e-5 -2e-5,4e-5 -10.99703,17.59669 -26.73837,32.48309 -45.62354,41.05028 -18.86679,8.56235 -40.97577,10.62224 -60.69798,4.18753 -19.70075,-6.41957 -36.81476,-21.63721 -44.12348,-41.09632 -1e-5,-1e-5 -1e-5,-2e-5 -2e-5,-4e-5 -4.28995,-11.39709 -5.24786,-24.06555 -2.70195,-36.01526 1e-5,-10e-6 1e-5,-3e-5 1e-5,-4e-5 2.54486,-11.94993 8.59093,-23.16753 17.20927,-31.88444 8.61784,-8.71743 19.79403,-14.91971 31.79241,-17.61897 11.99831,-2.69962 24.79318,-1.89024 36.38985,2.32335 -11.54904,-4.34244 -24.37178,-5.30819 -36.47806,-2.7259 -12.1062,2.58263 -23.45794,8.70534 -32.28707,17.43879 -8.8286,8.73394 -15.10246,20.047 -17.83411,32.20281 -10e-6,2e-5 -10e-6,3e-5 -10e-6,5e-5 -2.73059,12.15605 -1.90763,25.10481 2.36364,36.85151 7.30909,20.05762 24.63949,35.90827 44.92885,42.75685 20.2861,6.83947 43.07927,5.02825 62.68715,-3.63057 19.59903,-8.65826 36.02357,-23.7863 47.55353,-41.83066 10e-6,-1e-5 10e-6,-2e-5 2e-5,-4e-5 11.52632,-18.03774 18.338,-38.83231 21.25989,-59.9856 5.76053,-41.57518 -3.49734,-85.13275 -25.80135,-120.88527 -10e-6,-10e-6 -10e-6,-2e-5 -2e-5,-3e-5 -22.31369,-35.74639 -57.46044,-63.34535 -97.65357,-76.5478 -40.19749,-13.18899 -85.02233,-11.84358 -124.492218,3.84274 -39.463577,15.70194 -73.127045,45.56788 -93.4517352,83.05167 z"
             id="path4368" />
        </g>
      </svg>
      <br>
      <span class='high-score'>
      </span>
      <br>
      <button class='play'>
        PLAY
      </button>
    </div>

    <div class='game-over-screen'>
      <div class='game-over-text'></div>
      <br>
      <div class='score'>
      </div>
      <div class='best'>
      </div>
      <button class='play-again'>
        PLAY AGAIN
      </button>
    </div>
    <script>

    /**
     * Draws a rounded rectangle using the current state of the canvas.
     * If you omit the last three params, it will draw a rectangle
     * outline with a 5 pixel border radius
     * @param {CanvasRenderingContext2D} ctx
     * @param {Number} x The top left x coordinate
     * @param {Number} y The top left y coordinate
     * @param {Number} width The width of the rectangle
     * @param {Number} height The height of the rectangle
     * @param {Number} radius The corner radius. Defaults to 5;
     * @param {Boolean} fill Whether to fill the rectangle. Defaults to false.
     * @param {Boolean} stroke Whether to stroke the rectangle. Defaults to true.
     */
    function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
      if (typeof stroke == "undefined" ) {
        stroke = true;
      }
      if (typeof radius === "undefined") {
        radius = 5;
      }
      x -= width / 2
      y -= height / 2
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
      if (stroke) {
        ctx.stroke();
      }
      if (fill) {
        ctx.fill();
      }
    }


    function shuffle(array) {
        var counter = array.length, temp, index;

        // While there are elements in the array
        while (counter > 0) {
            // Pick a random index
            index = Math.floor(Math.random() * counter);

            // Decrease counter by 1
            counter--;

            // And swap the last element with it
            temp = array[counter];
            array[counter] = array[index];
            array[index] = temp;
        }

        return array;
    }

    function distanceBetween(point1, point2) {
      return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2))
    }
    function angleBetween(point1, point2) {
      return Math.atan2( point2.x - point1.x, point2.y - point1.y )
    }

    function Color(r, g, b, a) {
      r = r === undefined ? 0 : r
      g = g === undefined ? 0 : g
      b = b === undefined ? 0 : b
      a = a === undefined ? 1 : a

      this.r = r
      this.g = g
      this.b = b
      this.a = a

      this.cache = {}
    }

    Color.prototype.alpha = function (n) {
      if (this.cache[n]) return this.cache[n]
      var color = new Color(this.r, this.g, this.b, n)
      this.cache[n] = color
      return this.cache[n]
    }

    Color.prototype.toString = function () {
      return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + this.a + ')'
    }

    Color.prototype.equals = function (color) {
      return this.r === color.r &&
              this.g === color.g &&
              this.b === color.b &&
              this.a === color.a
    }
var endGameTexts = shuffle([
  'Good one! Now see if you can beat it!',
  'You Rock! Let\'s do it again!',
  'Great job! But can you beat it?',
  'You\'re unstoppable! Keep it up!',
  'Amazing! I bet you can\'t beat it though...'
])
var endGameIndex = 0

var RATIO = window.devicePixelRatio || 1
var WIDTH = window.innerWidth * RATIO
var HEIGHT = window.innerHeight * RATIO
var SCALE = HEIGHT
var PI = Math.PI
var TAO = PI * 2
var WIDTH2 = ~~(WIDTH / 2)
var HEIGHT2 = ~~(HEIGHT / 2)
var RADIUS = ~~(SCALE / 5.6)
var $white = new Color(249, 249, 249)
var $bgColor = new Color(158, 158, 158)

var canv = document.getElementById('canv')
canv.width = WIDTH
canv.height = HEIGHT
var ctx = canv.getContext('2d')
ctx.lineJoin = ctx.lineCap = 'round'
ctx.translate(WIDTH2, HEIGHT2)


var completionBaseline = 0

var palletSize = SCALE / 20
var palletBoxSize = palletSize + SCALE / 60
var palletMargin = SCALE / 60
var pallet = []

var intervals = []
var completion = 0
var isDrawing = false
var lastPoint = null
var selectedPallet = null
var time = 60
var levelIndex = 0
var isPlaying = false
canv.addEventListener('mousedown', function (e) {
  if (!isPlaying) return
  drawStart({x: e.clientX * RATIO, y: e.clientY * RATIO})
  e.stopPropagation()
  e.preventDefault()
})

canv.addEventListener('touchstart', function (e) {
  if (!isPlaying) return
  drawStart({x: e.touches[0].clientX * RATIO, y: e.touches[0].clientY * RATIO})
  e.stopPropagation()
  e.preventDefault()
})

canv.addEventListener('mousemove', function (e) {
  if (!isPlaying) return
  draw({x: e.clientX * RATIO, y: e.clientY * RATIO})
  e.stopPropagation()
  e.preventDefault()
})

canv.addEventListener('touchmove', function (e) {
  if (!isPlaying) return
  draw({x: e.touches[0].clientX * RATIO, y: e.touches[0].clientY * RATIO})
  e.stopPropagation()
  e.preventDefault()
})

canv.addEventListener('mouseup', function (e) {
  if (!isPlaying) return
  e.stopPropagation()
  e.preventDefault()
  drawEnd()
})

canv.addEventListener('touchend', function (e) {
  if (!isPlaying) return
  e.stopPropagation()
  e.preventDefault()
  drawEnd()
})

window.addEventListener('keydown', function (e) {
  if (e.which >= 49 && e.which < 59) {
    var index = e.which - 49
    if (pallet[index]) {
      selectedPallet = pallet[index]
      paintPallet()
    }
  }
})
var cy = -RADIUS * 1.5
var levels = [
  [ // 1
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, 0, TAO)
      }
    }
  ],
  [ // 2
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, PI / 2, PI + PI / 2)
      }
    },
    {
      color: new Color(145,167,255),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, PI + PI / 2, TAO + PI / 2)
      }
    }
  ],
  [ // 3
    {
      color: new Color(42,54,177),
      path: function (ctx) {
        var a1 = TAO / 3
        var a2 = TAO / 3 * 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = 0
        var a2 = TAO / 3
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(145,167,255),
      path: function (ctx) {
        var a1 = TAO / 3 * 2
        var a2 = TAO
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    }
  ],
  [ // 4
    {
      color: new Color(42,54,177),
      path: function (ctx) {
        var a1 = TAO / 4
        var a2 = TAO / 4 * 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = TAO / 4 * 2
        var a2 = TAO / 4 * 3
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(145,167,255),
      path: function (ctx) {
        var a1 = 0
        var a2 = TAO / 4
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(255,152,0),
      path: function (ctx) {
        var a1 = TAO / 4 * 3
        var a2 = TAO
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    }
  ],
  [ // 5
    {
      color: new Color(42,54,177),
      path: function (ctx) {
        var a1 = PI / 2 + PI / 6
        var a2 = -PI / 2 - PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)

      }
    },
    {
      color: new Color(255,204,128),
      path: function (ctx) {
        var a1 = -PI / 2
        var a2 = -PI / 2 - PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, true)

        var a3 = PI / 2 + PI / 6
        var a4 = PI / 2
        ctx.arc(0, cy, RADIUS, a3, a4, true)

      }
    },
    {
      color: new Color(255,152,0),
      path: function (ctx) {
        var a1 = -PI / 2
        var a2 = -PI / 2 + PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)

        var a3 = PI / 2 - PI / 6
        var a4 = PI / 2
        ctx.arc(0, cy, RADIUS, a3, a4)

      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = -PI / 2 + PI / 6
        var a2 = PI / 2 - PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)

      }
    }
  ],
  [ // 6
    {
      color: new Color(255,152,0),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, 0, TAO)
        ctx.arc(0, cy, RADIUS / 2, 0, TAO, true)
      }
    },
    {
      color: new Color(37,155,36),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS / 2, 0, TAO)
      }
    }
  ],
  [ // 7
    {
      color: new Color(255,152,0),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, 0, TAO)
        ctx.arc(0, cy, RADIUS / 3 * 2, 0, TAO, true)
      }
    },
    {
      color: new Color(37,155,36),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS / 3 * 2, 0, TAO)
        ctx.arc(0, cy, RADIUS / 3, 0, TAO, true)
      }
    },
    {
      color: new Color(114,213,114),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS / 3, 0, TAO)
      }
    }
  ],
  [ // 8
    {
      color: new Color(37,155,36),
      path: function (ctx) {
        var a1 = PI / 2 + PI / 4
        var a2 = PI / 2 + PI / 4 * 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, false)

        var a3 = -PI / 2 + PI / 4 * 2
        var a4 = -PI / 2 + PI / 4
        ctx.arc(0, cy, RADIUS, a3, a4, true)
      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = PI / 2
        var a2 = PI / 2 + PI / 4
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, false)

        var a3 = -PI / 2 + PI / 4
        var a4 = -PI / 2
        ctx.arc(0, cy, RADIUS, a3, a4, true)
      }
    },
    {
      color: new Color(255,152,0),
      path: function (ctx) {
        var a1 = -PI / 2
        var a2 = -PI / 2 - PI / 4
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, true)

        var a3 = PI / 2 - PI / 4
        var a4 = PI / 2
        ctx.arc(0, cy, RADIUS, a3, a4, false)
      }
    },
    {
      color: new Color(66,66,66),
      path: function (ctx) {
        var a1 = PI / 2 + PI / 4 * 2
        var a2 = PI / 2 + PI / 4 * 3
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, false)

        var a3 = -PI / 2 + PI / 4 * 3
        var a4 = -PI / 2 + PI / 4 * 2
        ctx.arc(0, cy, RADIUS, a3, a4, true)
      }
    },
  ],
  [ // 9
    {
      color: new Color(66,189,65),
      path: function (ctx) {
        var a1 = -PI / 2 - PI / 6
        var a2 = -PI / 2 - PI / 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, true)
        ctx.lineTo(-RADIUS/2, cy)
      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = TAO / 6 * 2
        var a2 = TAO / 6 * 3
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(255,241,118),
      path: function (ctx) {
        var a1 = TAO / 6
        var a2 = TAO / 6 * 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(86,119,252),
      path: function (ctx) {
        var a1 = 0
        var a2 = TAO / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)

        ctx.lineTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(255,183,77),
      path: function (ctx) {
        var a1 = -PI / 2
        var a2 = -PI / 2 - PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, true)
        ctx.lineTo(-RADIUS/2, cy)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(243,108,96),
      path: function (ctx) {
        var a1 = -PI / 2
        var a2 = -PI / 2 + PI / 6
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, false)
        ctx.lineTo(RADIUS/2, cy)
        ctx.lineTo(0, cy)
      }
    },
    {
      color: new Color(66,189,65),
      path: function (ctx) {
        var a1 = -PI / 2 + PI / 6
        var a2 = -PI / 2 + PI / 2
        var x = RADIUS * Math.cos(a1)
        var y = cy + RADIUS * Math.sin(a1)
        ctx.moveTo(x, y)
        ctx.arc(0, cy, RADIUS, a1, a2, false)
        ctx.lineTo(RADIUS/2, cy)
      }
    },

  ],
  [ // 10
    {
      color: new Color(0,102,255),
      path: function (ctx) {
        // 17.777
        // 32
        // 9.7
        // 10.66
        var thick = SCALE/17.77
        var width = SCALE/32
        var size = SCALE/9.7
        var length = SCALE/10.6
        //   |-> -> ->|
        //   |<- <- <-|
        //          //
        //        //
        //     //
        //   |-> -> ->|
        //   |<- <- <-|


        //   -> -> ->|
        //           |
        ctx.moveTo(-length, cy - size)
        ctx.lineTo(length, cy - size)
        ctx.lineTo(length, cy - thick)

        //          /
        //        /
        //     /
        ctx.lineTo(-width, cy + thick)

        //   -> -> ->|
        //           |
        ctx.lineTo(length, cy + thick)
        ctx.lineTo(length, cy + size)

        //   |
        //   |<- <- <-|
        ctx.lineTo(-length, cy + size)
        ctx.lineTo(-length, cy + thick)

        //          /
        //        /
        //     /
        ctx.lineTo(width, cy - thick)

        //   |
        //   |<- <- <-|
        ctx.lineTo(-length, cy - thick)
        ctx.lineTo(-length, cy - size)
      }
    },
    {
      color: new Color(0,0,0),
      path: function (ctx) {
        ctx.arc(0, cy, RADIUS, 0, TAO)
      }
    }
  ]
]


function newGame() {
  var i = intervals.length
  clearIntervals()
  levelIndex = 0
  completion = 0
  isDrawing = false
  lastPoint = null
  selectedPallet = null
  time = 60
  isPlaying = true

  setPallet()
  repaint()

  // completion of 80%+ triggers next level
  intervals.push(setInterval(function () {
    completion = getCompletion() / completionBaseline
    paintCompletion()
    if (completion >= 0.80) {
      if (levelIndex + 1 < levels.length){
        levelIndex++
        slide()
        setTimeout(function () {
          repaint()
        }, 250)
      }
    }
  }, 500))

  intervals.push(setInterval(function () {
    time--
    paintTime()

    if (time <= 0) {
      isPlaying = false
      clearIntervals()
      var score = getScore()
      var isHigh = saveScore()
      hideGame()
      ga('send', 'event', 'game', 'end', 'score', score)
      showEnd(score, isHigh)
    }
  }, 1000))

}

function slide() {
  canv.className = canv.className + ' slide-out'
  setTimeout(function () {
    canv.className = canv.className.replace('slide-out', '')
  }, 250)
}

function getScore() {
  return levelIndex * 100 + completion * 100 | 0
}

function saveScore() {
  var curScore = localStorage.highScore || 0
  var score = getScore()
  if (parseInt(curScore) < score) {
    localStorage.highScore = score
    return true
  }
  return false
}

function clearIntervals() {
  var i = intervals.length
  while(i--) {
    window.clearInterval(intervals[i])
  }
  intervals = []
}

function paintBg() {
  ctx.fillStyle = $bgColor.toString()
  ctx.fillRect(-WIDTH2, -HEIGHT2, WIDTH, HEIGHT)
}

function paintTime() {
  var fontSize = SCALE / 30
  var padding = SCALE / 60
  var seconds = time + 's'
  var x = WIDTH2 - padding - fontSize * 2
  var y = -HEIGHT2 + fontSize + padding


  ctx.fillStyle = $bgColor.toString()
  ctx.fillRect(x, y - fontSize, fontSize * 3, fontSize + 2)

  ctx.textAlign = 'left'
  if (time <= 10) {
    ctx.fillStyle = '#c41411'
  } else {
    ctx.fillStyle = '#424242'
  }
  ctx.font = 'bold ' + fontSize + 'px "Open Sans", sans'

  ctx.fillText(seconds, x, y)
}

function isOnTimeText(point) {
  var fontSize = SCALE / 30
  var padding = SCALE / 60
  var x = WIDTH2 - padding - fontSize * 3
  var y = -HEIGHT2 + fontSize + padding + fontSize

  return point.x > x && point.y < y
}

// this clears user edits!
function repaint() {
  paintBg()
  paintLevel()
  selectedPallet = null
  setPallet()
  paintPallet()
  completionBaseline = getCompletion(true)
  paintCompletion()
  paintTime()
  isDrawing = false
}

function paintCompletion() {
  var fontSize = SCALE / 30
  var padding = SCALE / 60
  var x = -WIDTH2 + padding
  var y = -HEIGHT2 + fontSize + padding
  var percent = ~~(Math.max(0, completion - 0.02) * 100) + '%'

  ctx.fillStyle = $bgColor.toString()
  ctx.fillRect(x, y - fontSize, fontSize * 2, fontSize + 2)

  ctx.textAlign = 'left'
  ctx.fillStyle = '#222'
  ctx.font = 'bold ' + fontSize + 'px "Open Sans", sans'

  ctx.fillText(percent, x, y)
}

function isOnCompletionText(point) {
  var fontSize = SCALE / 30
  var padding = SCALE / 60
  var x = -WIDTH2 + padding + fontSize * 3
  var y = -HEIGHT2 + fontSize + padding + fontSize

  return point.x < x && point.y < y
}

function getCompletion(invert) {
  var imgData = ctx.getImageData(WIDTH2 - RADIUS, 0, RADIUS * 2, HEIGHT2)
  var pixels = imgData.data
  var white = 0

  var l = pixels.length
  var i = l
  while (i >= 4) {
    var r = pixels[i-3]
    var g = pixels[i-2]
    var b = pixels[i-1]


    // Get all whites
    if (!invert) {
      if (r > 240 && g > 240 && b > 240) {
        white += 1
      }
    } else {
      // all non-whites
      if (r < 240 || g < 240 || b < 240) {
        // all non-grays
        if (r !== 158 && g !== 158 && b !== 158) {
          white += 1
        }
      }
    }


    i -= ~~(l / 1000)
  }
  return white
}


function paintLevel() {
  var level = levels[levelIndex]

  ctx.beginPath()
  ctx.arc(0, -RADIUS * 1.5, RADIUS, 0, 2 * PI, false)
  ctx.fillStyle = $white.toString()
  ctx.fill()

  ctx.beginPath()
  ctx.arc(0, RADIUS * 1.5, RADIUS, 0, 2 * PI, false)
  ctx.fillStyle = $white.toString()
  ctx.fill()

  var i = level.length
  while (i--) {
    var poly = level[i]
    ctx.fillStyle = poly.color.toString()
    ctx.beginPath()
    var x = 0
    var y = -RADIUS * 1.5
    ctx.moveTo(x, y)
    poly.path(ctx, x, y)
    ctx.fill()
  }

  if (levelIndex === 0) {
    ctx.fillStyle = '#000'
    ctx.font = SCALE / 25 + 'px "Open Sans", sans'
    ctx.textAlign = 'center'
    ctx.fillText('Color Me!', 0, RADIUS * 1.5 + SCALE / 25 / 3)
  }
}



function setPallet() {
  var colors = []
  var level = levels[levelIndex]

  // _.pick level, 'color'
  var i = level.length
  while (i--) {
    var poly = level[i]
    colors.push(poly.color)
  }
  i = colors.length

  // _.uniq colors
  var used = {}
  while (i--) {
    var color = colors[i]
    if (used[color]) {
      colors.splice(i, 1)
    }
    used[color] = true
  }

  i = colors.length

  // clear pallet
  pallet = []
  var y = 0
  var halfColors = ~~(colors.length / 2)
  var x = -palletBoxSize * halfColors - palletMargin * halfColors
  if (colors.length % 2 === 0) {
    x += palletBoxSize / 2 + palletMargin / 2
  }

  while(i--) {
    var color = colors[i]
    var pal = {
      color: color,
      x: x,
      y: y
    }

    pallet.push(pal)

    x += palletBoxSize + palletMargin
  }

  if (!selectedPallet) {
    selectedPallet = pallet[0]
  }

}

function paintPallet() {
  var i = pallet.length
  var boxSize = palletBoxSize
  var size = palletSize

  ctx.fillStyle = $bgColor.toString()
  ctx.fillRect(-WIDTH2, -boxSize / 2 - 1, WIDTH, boxSize + 2)
  while(i--) {
    if (pallet[i] === selectedPallet) {
      ctx.fillStyle = $white.toString()
      ctx.fillRect(pallet[i].x-boxSize/2, -boxSize/2, boxSize, boxSize)
    }

    ctx.fillStyle = pallet[i].color.toString()
    roundRect(ctx, pallet[i].x, 0, size, size, SCALE/150, true, false)
  }
}

function selectPallet(point) {
  var i = pallet.length
  while(i--) {
    var boxPoint = {x: pallet[i].x + WIDTH2, y: pallet[i].y + HEIGHT2}
    if (distanceBetween(boxPoint, point) < palletBoxSize / 2 ) {
      selectedPallet = pallet[i]
      paintPallet()
      break
    }
  }
}

function drawStart(point) {
  isDrawing = true
  lastPoint = point

  selectPallet(point)
}

function drawEnd() {
  isDrawing = false
}

function getRegion() {
  var level = levels[levelIndex]
  var i = level.length
  while(i--) {
    var poly = level[i]
    if (poly.color.equals(selectedPallet.color)) {
      return poly
    }
  }

  throw new Error('Poly not found')
}

function draw(point) {
  if (!isDrawing) return

  var currentPoint = point
  var dist = distanceBetween(lastPoint, currentPoint)
  var angle = angleBetween(lastPoint, currentPoint)
  var region = getRegion()

  var brushSize = SCALE / 24|0

  for (var i = 0; i < dist; i+=5) {

    var x = (lastPoint.x + (Math.sin(angle) * i) - WIDTH2)|0
    var y = (lastPoint.y + (Math.cos(angle) * i) - HEIGHT2)|0

    // Don't color the area with the pallet
    if (y < SCALE / 20 + 5 && y > -SCALE / 20 - 5) continue

    // Don't color the area with the percent
    var pt = {x: x, y: y}
    if (isOnCompletionText(pt)) continue
    if (isOnTimeText(pt)) continue

    var radgrad = ctx.createRadialGradient(x,y,brushSize/4|0,x,y,brushSize/2|0)

    radgrad.addColorStop(0, selectedPallet.color.toString())
    radgrad.addColorStop(0.5, selectedPallet.color.alpha(0.5).toString())
    radgrad.addColorStop(1, selectedPallet.color.alpha(0).toString())

    ctx.fillStyle = radgrad
    ctx.fillRect(x-brushSize/2|0, y-brushSize/2|0, brushSize, brushSize)

    if (y < 0) {
      y += RADIUS * 1.5 * 2|0
    } else {
      y -= RADIUS * 1.5 * 2|0
    }

    // Don't color the area with the percent
    pt.y = y
    if (isOnCompletionText(pt)) continue
    if (isOnTimeText(pt)) continue

    radgrad = ctx.createRadialGradient(x,y,brushSize/4|0,x,y,brushSize/2|0)
    radgrad.addColorStop(0, selectedPallet.color.toString())
    radgrad.addColorStop(0.5, selectedPallet.color.alpha(0.5).toString())
    radgrad.addColorStop(1, selectedPallet.color.alpha(0).toString())
    ctx.fillStyle = radgrad
    ctx.fillRect(x-brushSize/2|0, y-brushSize/2|0, brushSize, brushSize)

    if (y < 0) {
      // erase inside selected brush clip region
      ctx.save()
      ctx.beginPath()
      region.path(ctx)
      ctx.clip()

      radgrad = ctx.createRadialGradient(x,y,brushSize/4|0,x,y,brushSize/2|0)
      radgrad.addColorStop(0, $white.toString())
      radgrad.addColorStop(0.9, $white.alpha(1).toString())
      radgrad.addColorStop(1, $white.alpha(0).toString())
      ctx.fillStyle = radgrad
      ctx.fillRect(x-brushSize/2|0, y-brushSize/2|0, brushSize, brushSize)
      ctx.fillRect(x-brushSize/2|0, y-brushSize/2|0, brushSize, brushSize)

      ctx.restore()
    }

  }
  lastPoint = currentPoint

}
var CWIDTH = Math.min(window.innerWidth, window.innerHeight)
var CHEIGHT = CWIDTH


var $homeScreen = document.getElementsByClassName('home-screen')[0]
var $endScreen = document.getElementsByClassName('game-over-screen')[0]
var $endText = document.getElementsByClassName('game-over-text')[0]
var $score = document.getElementsByClassName('score')[0]
var $best = document.getElementsByClassName('best')[0]
var $logo = document.getElementsByClassName('logo')[0]

var $flourish = document.getElementsByClassName('flourish')[0]
var $play = document.getElementsByClassName('play')[0]
var $playAgain = document.getElementsByClassName('play-again')[0]

var $highScore = document.getElementsByClassName('high-score')[0]

var $paths = document.getElementsByTagName('path')

$logo.style.marginTop = CHEIGHT / 2 - CHEIGHT / 3 + 'px'
$logo.style.width = CWIDTH / 2 + 'px'
$logo.style.height = CWIDTH / 4 + 'px'


$flourish.style.marginTop = -CHEIGHT / 20 + 'px'
$flourish.style.width = CWIDTH / 3 + 'px'
$flourish.style.height = CWIDTH / 5 + 'px'


$play.style.marginTop = CHEIGHT / 20 + 'px'
$play.style.width = CWIDTH / 4 + 'px'
$play.style.height = CWIDTH / 7 + 'px'
$play.style.fontSize = CWIDTH / 20 + 'px'

$play.addEventListener('click', start)
$play.addEventListener('touchstart', start)

$playAgain.addEventListener('click', function () {
  ga('send', 'event', 'game', 'play', 'again')
  start()
})
$playAgain.addEventListener('touchstart', function () {
  ga('send', 'event', 'game', 'play', 'again')
  start()
})

if (localStorage.highScore) {
  $highScore.innerHTML = 'best: ' + localStorage.highScore
  $highScore.style.fontSize = CWIDTH / 30 + 'px'
}

setTimeout(function () {
  $play.style.opacity = 1
})

// This is hard coded because it crashes android if you calculate it
var pathLengths = [114.63752746582031, 135.55255126953125, 115.6463851928711, 147.36000061035156, 3442.748291015625, 1806.394775390625, 8450.58984375, 8450.58984375]
window.addEventListener('load', function () {
  var i = $paths.length
  while(i--) {
    // This line will crash android browser clients
    // pathLengths[i] = $paths[i].getTotalLength()
    simulatePathDrawing($paths[i], i)
  }

  document.body.style.visibility = 'visible'
})

//DEBUG
// start()
// hideHome()
// showEnd(10)

function hideHome() {
  $homeScreen.style.display = 'none'
}

function randomEndText() {
  var res = endGameTexts[endGameIndex]
  endGameIndex++
  endGameIndex %= endGameTexts.length
  return res
}

function showEnd(score, newHigh) {
  score = score || 0
  $score.innerHTML = (newHigh ? 'New High Score: ' : 'Score: ') + score
  $score.style.fontSize = CWIDTH / 20 + 'px'

  $best.style.fontSize = CWIDTH / 30 + 'px'

  if (!newHigh) {
    $best.innerHTML = 'Best: ' + localStorage.highScore || 0
  }

  $endScreen.style.display = 'block'

  $endText.innerHTML = score < 100 ? 'Are you even trying?' : randomEndText()
  $endText.style.fontSize = CWIDTH / 20 + 'px'
  $endText.style.marginTop = CHEIGHT / 2 - CHEIGHT / 6 + 'px'

  $playAgain.style.marginTop = CHEIGHT / 20 + 'px'
  $playAgain.style.width = CWIDTH / 2 + 'px'
  $playAgain.style.height = CWIDTH / 7 + 'px'
  $playAgain.style.fontSize = CWIDTH / 20 + 'px'

  setTimeout(function () {
    $playAgain.style.opacity = 1
  },100)
}

function hideEnd() {
  $endScreen.style.display = 'none'
}

function start() {
  hideHome()
  hideEnd()
  showGame()
  newGame()
}

function showGame() {
  canv.style.visibility = 'visible'
}

function hideGame() {
  canv.style.visibility = 'hidden'
}

function simulatePathDrawing(path, i) {
  //var path = document.querySelector('.squiggle-animated path');
  var length = pathLengths[i]
  // Clear any previous transition
  path.style.transition = path.style.WebkitTransition = 'none';
  // Set up the starting positions
  path.style.strokeDasharray = length + ' ' + length
  path.style.strokeDashoffset = length
  // Trigger a layout so styles are calculated & the browser
  // picks up the starting position before animating
  path.getBoundingClientRect()
  // Define our transition
  path.style.transition = path.style.WebkitTransition = 'stroke-dashoffset 1.25s ease-in-out'
  // Go!
  path.style.strokeDashoffset = '0'
  path.style.strokeWidth = '2px'
}

    </script>
  </body>
</html>
